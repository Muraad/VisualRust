<?xml version="1.0" encoding="utf-8" ?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <UsingTask AssemblyFile="$(VisualRustTasksPath)\VisualRust.Build.dll"
             TaskFactory="RustcFactory"
             TaskName="Rustc"/>

  <PropertyGroup>
    <VisualRustTasksPath>$(MSBuildExtensionsPath)\VisualRust</VisualRustTasksPath>
    <OutputType Condition="'$(OutputType)' != 'library'">exe</OutputType>
    <_EntryPoint Condition="'$(OutputType)'=='exe'">src\main.rs</_EntryPoint>
    <_EntryPoint Condition="'$(OutputType)'=='library'">src\lib.rs</_EntryPoint>
    <Configuration Condition="'$(Configuration)' == ''">Debug</Configuration>
    <PlatformTarget Condition="'$(PlatformTarget)' == ''" >default</PlatformTarget>
    <OutputPath Condition="'$(PlatformTarget)' == 'default'" >target\$(Configuration)\</OutputPath>
    <OutputPath Condition="'$(PlatformTarget)' != 'default'" >target\$(PlatformTarget)\$(Configuration)\</OutputPath>
    <LinkTimeOptimization Condition="'$(LinkTimeOptimization)' == ''">false</LinkTimeOptimization>
    <CrateName Condition="'$(CrateName)' ==''">$(MSBuildProjectName)</CrateName>
    <AssemblyName>$(CrateName)</AssemblyName>
  </PropertyGroup>

  <Target Name="CoreCompile">
    <Rustc Input="$(_EntryPoint)"
           OutputDirectory="$(IntermediateOutputPath)"
           WorkingDirectory="$(ProjectDir)"
           CrateName="$(CrateName)"
           CrateType="$(OutputType)"
           LTO="$(LinkTimeOptimization)"
           DebugInfo="$(DebugSymbols)"
           OptimizationLevel="$(OptimizationLevel)"
           TargetTriple="$(PlatformTarget)"/>
  </Target>
  <Import Project="$(MSBuildToolsPath)\Microsoft.Common.targets" />
  <Target Name="GetFrameworkPaths"/>
  <Target Name="CreateManifestResourceNames"/>
</Project>